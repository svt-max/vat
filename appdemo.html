<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortefor Mentorship Platform</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Load Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- 
      MODERNIZATION:
      Your 'style.css' content is now embedded here.
      This allows for tighter integration with the HTML and JS,
      especially for complex transitions.
    -->
    <style>
        /* --- Use Inter font family --- */
        body {
            font-family: 'Inter', sans-serif;
            /* Subtle gradient for the landing page */
            background-color: #f8fafc; /* Fallback */
            background-image: linear-gradient(to bottom, #f8fafc, #f1f5f9);
            transition: background-image 0.5s ease;
            /* Ensures content scrolls smoothly */
            overflow-x: hidden;
        }

        /* Simple loader animation */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6; /* blue-500 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Hide views by default */
        .view {
            display: none;
        }

        /* --- Landing Page / App Toggle Styles --- */

        #app-container {
            display: none;
            margin: 4rem auto; /* 16 (4*4) top/bottom margin, centered */
            width: 90%;
            max-width: 80rem; /* max-w-5xl */
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            
            /* "Slick" card styling */
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem; /* rounded-xl */
            /* This is the key to the "slick" feel, using backdrop-filter */
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            box-shadow: 0 20px 30px -10px rgba(0, 0, 0, 0.1);
        }

        /* On smaller screens, use a smaller max-width */
        @media (max-width: 1024px) {
            #app-container {
                max-width: 60rem; /* max-w-3xl */
            }
        }

        @media (max-width: 768px) {
            #app-container {
                max-width: 42rem; /* max-w-2xl */
                margin: 1rem auto; /* Smaller margin on mobile */
                /* Re-apply default padding from HTML on mobile */
                padding: 1.5rem !important; 
            }
        }


        /* Landing page is visible by default */
        .landing-page {
            display: block;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        /* When body.app-active is set by JS */
        body.app-active .landing-page {
            display: none;
            opacity: 0;
        }

        body.app-active #app-container {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* * MODERNIZATION: Animated Gradient Background
         * This creates the "slick" panning background you requested.
         */
        body.app-active {
            /* "Slick" gradient background for the app view */
            background-image: linear-gradient(135deg, #f0f9ff, #e0f2fe, #dbeafe, #eef2ff);
            background-size: 400% 400%;
            animation: bg-pan 15s ease infinite;
            
            /* Re-apply the original centering for the app view */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        @keyframes bg-pan {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Custom Component Styles --- */

        /* Custom styling for range sliders in Work Values Assessment */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px; /* h-2 */
            background: #e5e7eb; /* bg-gray-200 */
            border-radius: 9999px; /* rounded-lg */
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        /* Thumb (slider handle) */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6; /* blue-600 */
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6; /* blue-600 */
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Selected state for rating buttons in Review/Feedback views */
        .rating-btn.selected,
        .feedback-rating-btn.selected {
            background-color: #3b82f6; /* blue-600 */
            color: white;
            border-color: #3b82f6; /* blue-600 */
            font-weight: 600; /* font-semibold */
        }
        
        /* * MODERNIZATION: Enhanced Button Interactivity
         * Adds a "press" effect for better tactile feedback.
         */
        button {
            transition: transform 0.1s ease;
        }
        button:active {
            transform: scale(0.97);
        }

        /* --- Fade-in on Scroll Animation --- */

        /* Hide the element by default */
        .fade-in {
            opacity: 0;
            transition: opacity 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* MODERNIZATION: More dynamic scroll class */
        .fade-in-up {
           opacity: 0;
           transform: translateY(30px);
           transition: opacity 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                       transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* The state when it becomes visible */
        .fade-in.is-visible,
        .fade-in-up.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Project Health Check-in Modal Styles --- */

        .modal-overlay {
            /* "display: none" is still handled by .view class */
            position: fixed; /* Stays in place */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            
            /* Dark semi-transparent background */
            background-color: rgba(0, 0, 0, 0.6);
            
            /* Center the content */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;

            /* Use the same backdrop filter for a consistent "glass" feel */
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);

            /* High z-index to be on top */
            z-index: 100;

            /* Animation */
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* Override the .view[style*="display: block"] to use flex */
        .modal-overlay[style*="display: block"] {
            display: flex !important;
            opacity: 1;
        }

        .modal-content-wrapper {
            /* This is the white card */
            background: white;
            padding: 2rem;
            border-radius: 1rem; /* rounded-xl */
            box-shadow: 0 20px 30px -10px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 42rem; /* max-w-2xl */
            
            /* For scrolling on small screens */
            max-height: 90vh;
            overflow-y: auto;

            /* Animation */
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        /* When the modal becomes visible */
        .modal-overlay[style*="display: block"] .modal-content-wrapper {
            transform: scale(1);
        }


        /* Selected state for rating buttons */
        .health-rating-btn.selected {
            background-color: #3b82f6; /* blue-600 */
            color: white;
            border-color: #3b82f6; /* blue-600 */
            font-weight: 600; /* font-semibold */
        }

        /* --- Match Card Styles --- */

        /* The main card/button */
        .match-card {
            display: flex;
            align-items: center;
            width: 100%;
            background-color: #ffffff;
            border: 1px solid #e5e7eb; /* gray-200 */
            border-radius: 0.75rem; /* rounded-lg */
            padding: 1rem;
            margin-bottom: 0.75rem; /* space between cards */
            text-align: left;
            
            /* Slick shadow & transition */
            box-shadow: 0 4px 10px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Interactive hover state */
        .match-card:hover {
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.07);
            border-color: #dbeafe; /* blue-100 */
            cursor: pointer;
        }

        /* Icon container */
        .match-card-icon {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem; /* 48px */
            height: 3rem; /* 48px */
            border-radius: 9999px; /* rounded-full */
            margin-right: 1rem;
        }

        .match-card-icon.person {
            background-color: #e0f2fe; /* light blue bg */
            color: #0284c7; /* blue-700 */
        }

        .match-card-icon.project {
            background-color: #eef2ff; /* light indigo bg */
            color: #4f46e5; /* indigo-600 */
        }

        /* SVG icon styling */
        .match-card-icon svg {
            width: 1.5rem; /* 24px */
            height: 1.5rem; /* 24px */
        }

        /* Text content */
        .match-card-content {
            flex-grow: 1;
        }

        .match-card-title {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #1f2937; /* gray-800 */
        }

        .match-card-subtitle {
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* gray-500 */
        }

        /* Fit score badge */
        .match-card-score {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-left: 1rem;
        }

        .match-card-score .score-value {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700; /* font-bold */
            color: #16a34a; /* green-600 */
        }

        .match-card-score .score-label {
            font-size: 0.75rem; /* text-xs */
            font-weight: 500;
            color: #6b7280; /* gray-500 */
            text-transform: uppercase;
        }
        
        /* * MODERNIZATION: Slick View Transitions
         * These classes and animations will be controlled by the
         * updated 'changeView' function in the script.
         */
        @keyframes view-exit {
            0% { 
                opacity: 1; 
                transform: translateY(0);
            }
            100% { 
                opacity: 0; 
                transform: translateY(10px); 
            }
        }

        @keyframes view-enter {
            0% { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        /* We apply 'display: block' or 'display: flex' first, THEN apply the animation */
        
        .view.is-exiting {
            /* 'forwards' is key: it holds the state at the end of the animation
              so it stays invisible before we set 'display: none'.
            */
            animation: view-exit 0.25s ease-out forwards;
        }
        
        /* The 'changeView' function will add 'display: block', then
          add this class to trigger the fade-in.
        */
        .view.is-entering {
            animation: view-enter 0.25s ease-in;
        }

    </style>
</head>
<body class="">

    <!-- Landing Page (Visible by default) -->
    <main id="landing-page" class="landing-page">
        <!-- Navigation Bar -->
        <nav class="bg-white shadow-sm sticky top-0 z-50">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex-shrink-0 flex items-center">
                        <h1 class="text-2xl font-bold text-blue-600">Fortefor</h1>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="#problem" class="text-gray-500 hover:text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium">The Problem</a>
                        <a href="#insight" class="text-gray-500 hover:text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium">The Insight</a>
                        <a href="#solution" class="text-gray-500 hover:text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium">The Solution</a>
                    </div>
                    <div class="flex items-center">
                        <button class="get-started-btn bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                            Get Started
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <!-- MODERNIZATION: Added fade-in-up for more dynamic scroll -->
        <header class="bg-white fade-in-up">
            <div class="max-w-6xl mx-auto py-24 px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 sm:text-5xl md:text-6xl">
                    Stop Guessing. Start Matching.
                </h2>
                <p class="mt-6 max-w-2xl mx-auto text-xl text-gray-600">
                    The first platform to match freelancers, projects, and mentors based on personality, fit, and proven science.
                </p>
                <div class="mt-10">
                    <button class="get-started-btn bg-blue-600 text-white font-semibold py-4 px-10 rounded-lg shadow-lg text-lg hover:bg-blue-700 transition duration-300">
                        Find Your Perfect Fit
                    </button>
                </div>
            </div>
        </header>

        <!-- Section 1: The Problem -->
        <!-- MODERNIZATION: Added fade-in-up for more dynamic scroll -->
        <section id="problem" class="py-20 bg-gray-50 fade-in-up">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <p class="text-base text-blue-600 font-semibold tracking-wide uppercase">The Problem</p>
                    <h3 class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl">
                        Why Freelance Projects Fail
                    </h3>
                    <p class="mt-4 max-w-2xl mx-auto text-xl text-gray-600">
                        Most projects get expensive and fail due to a bad fit between the person and the project.
                    </p>
                </div>
                <div class="mt-12 text-lg text-gray-700 leading-relaxed max-w-4xl mx-auto">
                    <p class="mt-4">
                        Hiring is based on guesswork. Sometimes you need a creative genius, and other times you need someone to just listen to instructions. But how do you know who you're getting?
                    </p>
                    <p class="mt-4">
                        This guesswork is virtually impossible to work with. A brilliant freelancer might fail in a rigid corporate structure, while a detail-oriented freelancer might get lost in a fast-moving creative project.
                        <strong>This is not a failure of talent, it's a failure of matching.</strong>
                    </p>
                </div>
            </div>
        </section>

        <!-- Section 2: The Insight -->
        <!-- MODERNIZATION: Added fade-in-up for more dynamic scroll -->
        <section id="insight" class="py-20 bg-white fade-in-up">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="lg:grid lg:grid-cols-3 lg:gap-8 lg:items-center">
                    <div>
                        <p class="text-base text-blue-600 font-semibold tracking-wide uppercase">The Insight</p>
                        <h3 class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl">
                            The "Fit Score" is the Guideline
                        </h3>
                        <p class="mt-4 text-lg text-gray-600">
                            There are certain traits that define freelancers for a project. Personality traits, for example, allow them to help organizations that are more rigid by being more agreeable themselves. This inter-company/freelancer fit score is a great guideline for better projects.
                        </p>
                    </div>
                    <div class="mt-10 lg:mt-0 col-span-2 flex justify-center">
                        <div class="bg-blue-50 p-12 rounded-xl border-4 border-blue-200 text-center">
                            <div class="text-8xl font-extrabold text-blue-600">8x</div>
                            <div class="mt-4 text-2xl font-semibold text-gray-800">
                                Better Project Outcomes
                            </div>
                            <p class="mt-2 text-lg text-gray-600">
                                Good projects (with well-fitting freelancers) can have up to 8x better outcomes in time-to-delivery, customer satisfaction, and quality.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: The Solution (and the Kicker) -->
        <!-- MODERNIZATION: Added fade-in-up for more dynamic scroll -->
        <section id="solution" class="py-20 bg-gray-50 fade-in-up">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <p class="text-base text-blue-600 font-semibold tracking-wide uppercase">The Solution</p>
                    <h3 class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl">
                        Matching & Mentorship. Solved.
                    </h3>
                </div>
                <div class="mt-12 text-lg text-gray-700 leading-relaxed max-w-4xl mx-auto">
                    <p class="text-xl text-center font-medium text-gray-800">
                        The Fortefor solution pre-screens people based on these crucial elements and then matches them with projects. But wait, there's much more...
                    </p>
                    
                    <h4 class="mt-10 text-2xl font-bold text-gray-900">The Kicker: Integrated Mentorship</h4>
                    <p class="mt-4">
                        A huge kicker to really carry it home. The Fortefor talent follows the same philosophy: good people come in varying degrees of seniority and pricing. To offset this, Fortefor offers an <strong>integrated mentorship and coaching experience</strong>.
                    </p>
                    <p class="mt-4">
                        All freelancers on the platform either <strong>have a mentor or are a mentor</strong>â€”mostly both. This isn't just an add-on; it's cored to the model. It ensures that junior talent has senior guidance, guaranteeing quality and actionability. It allows senior talent to scale their expertise, and it creates a self-sustaining ecosystem of growth.
                    </p>

                    <h4 class="mt-10 text-2xl font-bold text-gray-900">A Unique Mentor-Mentee Fit Score</h4>
                    <p class="mt-4">
                        To make sure mentors have an equally great fit, we have another unique fit score. Based on the same dataset, we look at whether the mentor and mentee are <strong>complementary (Divergent Fit)</strong> or <strong>too different to understand each other</strong>.
                    </p>
                    <p class="mt-4">
                        It's all based on very scientific, very validated models from our partners at <a href="https://www.talentdatalabs.com/" target="_blank" rel="noopener" class="text-blue-600 font-medium hover:underline">Talent Data Labs</a>.
                    </p>
                </div>

                <div class="mt-16 text-center">
                    <button class="get-started-btn bg-blue-600 text-white font-semibold py-4 px-10 rounded-lg shadow-lg text-lg hover:bg-blue-700 transition duration-300">
                        Start Your Journey
                    </button>
                </div>
            </div>
        </section>
    </main>
    

    <!-- Main Application Container (Hidden by default) -->
    <div id="app-container" class="w-full max-w-2xl p-8">

        <!-- View 0: Role Selection -->
        <div id="role-selection-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Fortefor</h1>
                <p class="text-lg text-gray-600 mt-2">Mentor & Mentee Matching Platform</p>
            </header>
            <p class="text-center text-gray-700 mb-8">Please select your role to begin:</p>
            <div class="space-y-4">
                <button id="role-freelancer" class="w-full bg-blue-600 text-white font-semibold py-4 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 text-lg">
                    I am a Freelancer
                </button>
                <button id="role-company" class="w-full bg-gray-700 text-white font-semibold py-4 px-6 rounded-lg shadow-md hover:bg-gray-800 transition duration-300 text-lg">
                    I am a Company
                </button>
            </div>
            <button type="button" class="back-to-home w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-8">
                &larr; Back to Home
            </button>
        </div>

        <!-- View 0b: mentor-mentee select -->
        <div id="mentor-mentee-select-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Welcome to the Community</h1>
                <p class="text-lg text-gray-600 mt-2">Let's define your journey.</p>
            </header>
            
            <p class="text-center text-gray-700 mb-8 text-lg">What is your primary goal on the Fortefor platform?</p>
            
            <div class="space-y-4">
                <button id="select-find-mentor" class="w-full bg-blue-600 text-white font-semibold py-4 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 text-lg">
                    I want to <span class="font-bold">Find a Mentor</span>
                </button>
                <button id="select-be-mentor" class="w-full bg-blue-600 text-white font-semibold py-4 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 text-lg">
                    I want to <span class="font-bold">Be a Mentor</span>
                </button>
                <button id="select-both-roles" class="w-full bg-gray-200 text-gray-800 font-semibold py-4 px-6 rounded-lg shadow-sm hover:bg-gray-300 transition duration-300 text-lg">
                    I'm interested in <span class="font-bold">Both</span>
                </button>
            </div>

            <button type="button" class="back-to-role w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-8">
                &larr; Go Back
            </button>
        </div>

        <!-- View 0c: Mentee Goals Selection -->
        <div id="mentee-goals-view" class="view">
            <header class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800">What are your goals?</h2>
                <p class="text-gray-600">This is the most important step to finding the right mentor. Select all that apply.</p>
            </header>
            
            <form id="mentee-goals-form">
                <div class="space-y-4">
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentee-goal" value="portfolio" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">Building/improving my portfolio</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentee-goal" value="job-hunt" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">Job-hunting & interview prep</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentee-goal" value="skills" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">Improving my core UX/Design skills</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentee-goal" value="strategy" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">Career strategy and growth</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentee-goal" value="freelance" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">Navigating freelance life (pricing, clients, etc.)</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentee-goal" value="other" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">Other (you can discuss in your first call)</span>
                    </label>
                </div>
                
                <button type="submit" id="mentee-goals-next" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 mt-8">
                    Next
                </button>
                <button type="button" id="back-to-mentor-select" class="back-to-mentor-select-btn w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                    &larr; Go Back
                </button>
            </form>
        </div>

        <!-- View 0d: Mentor Focus Selection -->
        <div id="mentor-focus-view" class="view">
            <header class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800">How can you help?</h2>
                <p class="text-gray-600">This helps us match you with the right mentees. What topics are you passionate about teaching?</p>
            </header>
            
            <form id="mentor-focus-form">
                <div class="space-y-4">
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentor-focus" value="portfolio" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">I'd like to help with portfolio building</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentor-focus" value="job-hunt" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">I can help with job-hunting & interview prep</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentor-focus" value="skills" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">I enjoy teaching core UX/Design skills</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentor-focus" value="strategy" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">I'm good at career strategy and growth</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentor-focus" value="freelance" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">I can share my freelance experience (pricing, clients)</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" name="mentor-focus" value="share" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-4 text-gray-700 text-lg">I just enjoy sharing knowledge and supporting growth</span>
                    </label>
                </div>
                
                <button type="submit" id="mentor-focus-next" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 mt-8">
                    Next
                </button>
                <button type="button" id="back-to-mentor-select" class="back-to-mentor-select-btn w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                    &larr; Go Back
                </button>
            </form>
        </div>
        <!-- View 0e: Logistics / Availability Selection -->
        <div id="logistics-availability-view" class="view">
            <header class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Set your availability</h2>
                <p class="text-gray-600">How often are you available and in what format? This helps us find a match that works for your schedule.</p>
            </header>
            
            <form id="logistics-form">
                <div class="mb-6">
                    <label class="block text-lg font-medium text-gray-700 mb-2">How often can you meet?</label>
                    <div class="space-y-4">
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="availability" value="weekly" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500" required>
                            <span class="ml-4 text-gray-700">Weekly</span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="availability" value="bi-weekly" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500" required>
                            <span class="ml-4 text-gray-700">Every 2 weeks</span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="availability" value="monthly" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500" required>
                            <span class="ml-4 text-gray-700">Monthly</span>
                        </label>
                    </div>
                </div>

                <div class="mb-8">
                    <label class="block text-lg font-medium text-gray-700 mb-2">Preferred formats? (Select all that work)</label>
                    <div class="space-y-4">
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="checkbox" name="format" value="video" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-4 text-gray-700">Video calls</span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="checkbox" name="format" value="chat" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-4 text-gray-700">Async chat</span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="checkbox" name="format" value="email" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-4 text-gray-700">Email / Portfolio Review</span>
                        </label>
                    </div>
                </div>
                
                <button type="submit" id="logistics-next" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                    Next
                </button>
            </form>
        </div>

        <!-- View 0f: Work Values Assessment -->
        <div id="work-values-assessment-view" class="view">
            <header class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Your Ideal Work Environment</h2>
                <p class="text-gray-600" id="wva-progress-text">Category 1 of 5</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
                    <div id="wva-progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 20%"></div>
                </div>
            </header>
            
            <div id="wva-question-container">
                <h3 class="text-xl font-semibold text-gray-800 mb-6" id="wva-category-title">Category Title Here</h3>
                
                <form id="wva-form">
                    <div id="wva-scales-container" class="space-y-6">
                        <div class="wva-question">
                            <label for="wva-q-1" class="block text-lg font-medium text-gray-700 mb-2">A creative and high-energy work environment</label>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm text-gray-500">Not important</span>
                                <input type="range" id="wva-q-1" name="wva-q-1" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                <span class="text-sm text-gray-500">Very important</span>
                            </div>
                        </div>
                        </div>
                    
                    <button type="submit" id="wva-next-button" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 mt-8">
                        Next Category
                    </button>
                </form>
            </div>
        </div>

        <!-- View 1: Registration -->
        <div id="register-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Fortefor</h1>
                <p class="text-lg text-gray-600 mt-2">Mentor & Mentee Matching Platform</p>
            </header>
            
            <p class="text-gray-700 mb-6">Welcome! To find your ideal mentor or mentee, we need to learn more about your work style. Let's start with a quick assessment.</p>
            
            <form id="register-form">
                <div class="mb-4">
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="name" name="name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Jane Doe" required>
                </div>
                <div class="mb-6">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="email" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="jane.doe@fortefor.com" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                    Start Assessment
                </button>
                <button type="button" class="back-to-role w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                    &larr; Go Back
                </button>
            </form>
        </div>

        <!-- View 2: Assessment -->
        <div id="assessment-view" class="view">
            <header class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Talent Assessment</h2>
                <p class="text-gray-600" id="progress-text">Question 1 of 5</p>
                <!-- Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 20%"></div>
                </div>
            </header>
            
            <div id="question-container">
                <!-- Question will be injected here -->
                <p class="text-lg font-medium text-gray-900 mb-6" id="question-text"></p>
                
                <!-- Scales (Answers) will be injected here -->
                <form id="assessment-form">
                    <div id="scales-container" class="space-y-4">
                        <!-- Example: 
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="answer" value="1" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                            <span class="ml-3 text-gray-700">Completely Disagree</span>
                        </label>
                        -->
                    </div>
                    <p id="answer-error" class="text-red-500 text-sm mt-4" style="display: none;">Please select an answer.</p>
                    <button type="submit" id="next-button" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 mt-8">
                        Next
                    </button>
                </form>
            </div>
        </div>

        <!-- View 3: Loading -->
        <div id="loading-view" class="view flex-col items-center justify-center h-64">
            <div class="loader"></div>
            <p class="text-lg text-gray-700 mt-6">Analyzing your results...</p>
            <p class="text-gray-600">Matching you with projects and people.</p>
        </div>

        <!-- View 4: Results -->
        <div id="results-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800" id="results-header">Welcome, Jane!</h1>
                <p class="text-lg text-gray-600 mt-2">Here are your recommended matches.</p>
            </header>

            <!-- Recommended Projects -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">Recommended Projects</h2>
                <ul id="projects-list" class="divide-y divide-gray-200">
                    <!-- Projects injected here -->
                </ul>
            </div>
            
            <!-- Recommended Mentors -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">Potential Mentors</h2>
                <ul id="mentors-list" class="divide-y divide-gray-200">
                    <!-- Mentors injected here -->
                </ul>
            </div>

            <!-- Recommended Mentees -->
            <div>
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">Potential Mentees</h2>
                <ul id="mentees-list" class="divide-y divide-gray-200">
                    <!-- Mentees injected here -->
                </ul>
            </div>

            <button id="view-insights-button" class="w-full bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-700 transition duration-300 mt-12">
                &larr; Back to My Insights
            </button>
            <button type="button" class="back-to-home w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                &larr; Back to Home
            </button>
        </div>

        <!-- View 5: Company Login -->
        <div id="company-login-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Company Portal</h1>
                <p class="text-lg text-gray-600 mt-2">Find the best talent for your projects.</p>
            </header>
            
            <form id="company-login-form">
                <div class="mb-4">
                    <label for="company-name" class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                    <input type="text" id="company-name" name="company-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Acme Inc." required>
                </div>
                <div class="mb-6">
                    <label for="company-email" class="block text-sm font-medium text-gray-700 mb-1">Your Email Address</label>
                    <input type="email" id="company-email" name="company-email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="manager@acme.com" required>
                </div>
                <button type="submit" class="w-full bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-800 transition duration-300">
                    Log In / Register
                </button>
                <button type="button" class="back-to-role w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                    &larr; Go Back
                </button>
            </form>
        </div>

        <!-- View 5b: Company Culture Start -->
        <div id="company-culture-start-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Define Your Culture</h1>
                <p class="text-lg text-gray-600 mt-2">This is the key to finding talent that "just gets it."</p>
            </header>
            
            <p class="text-gray-700 mb-6 text-lg">
                Before you post a project, we need to understand your company's work style. Is your environment rigid or agile? Creative or structured? 
            </p>
            <p class="text-gray-700 mb-8 text-lg">
                This 5-minute assessment will create a **Company Culture Profile**. We use this profile to match you with freelancers who will thrive in your specific environment, ensuring a better fit and project outcome.
            </p>
            
            <form id="company-culture-start-form">
                <button type="submit" id="company-culture-begin-btn" class="w-full bg-blue-600 text-white font-semibold py-4 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 text-lg">
                    Begin Profile (5 min)
                </button>
                <button type="button" class="back-to-home w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                    &larr; Go Back (Log Out)
                </button>
            </form>
        </div>

        <!-- View: Dashboard (Container for two sub-dashboards) -->
        <div id="dashboard-view" class="view">
            
            <!-- Freelancer Dashboard -->
            <div id="freelancer-dashboard-content" style="display: none;">
                <header class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800" id="freelancer-welcome">Welcome, Jane!</h1>
                    <p class="text-lg text-gray-600 mt-2">This is your central hub for projects and mentorship.</p>
                </header>

                <div class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">My Mentorship</h2>
                    <div id="my-mentor-card" class="p-4 bg-blue-50 border border-blue-200 rounded-lg mb-4">
                        <p class="text-sm font-medium text-blue-800">YOUR MENTOR</p>
                        <p class="text-xl font-semibold text-blue-700">Dr. Elena Rodriguez</p>
                        <button class="text-blue-600 font-medium hover:underline mt-1">Send Message</button>
                    </div>
                    <p class="text-lg font-medium text-gray-700 mb-2">YOUR MENTEES (2)</p>
                    <ul id="my-mentees-list" class="divide-y divide-gray-200 border rounded-lg p-4">
                        <li class="py-2 flex justify-between items-center">
                            <span class="text-gray-800">Jia Li</span>
                            <button class="text-blue-600 font-medium hover:underline">View Profile</button>
                        </li>
                        <li class="py-2 flex justify-between items-center">
                            <span class="text-gray-800">Sam O'Connell</span>
                            <button class="text-blue-600 font-medium hover:underline">View Profile</button>
                        </li>
                    </ul>
                </div>

                <div class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">Recommended Projects</h2>
                    <ul id="dashboard-projects-list" class="divide-y divide-gray-200">
                        <!-- Project cards injected here -->
                    </ul>
                    <button id="dashboard-see-all-matches-btn" class="w-full text-blue-600 font-semibold py-3 px-6 rounded-lg hover:bg-blue-50 transition duration-300 mt-4">
                        See All Matches &rarr;
                    </button>
                </div>

                <button id="dashboard-view-insights-btn" class="w-full bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-700 transition duration-300">
                    View My Personal Insights
                </button>

                <button id="temp-health-check-trigger" class="w-full bg-yellow-500 text-black font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-yellow-600 transition duration-300 mt-4">
                    (Test) Trigger Project Health Check
                </button>
            </div>
            
            <!-- Client Dashboard -->
            <div id="client-dashboard-content" style="display: none;">
                <header class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800" id="client-welcome">Acme Inc. Dashboard</h1>
                    <p class="text-lg text-gray-600 mt-2">Manage your challenges and find expert talent.</p>
                </header>

                <button id="dashboard-post-challenge-btn" class="w-full bg-blue-600 text-white font-semibold py-4 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 text-lg mb-8">
                    + Post a New Challenge
                </button>

                <div class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">Active Challenges</h2>
                    <ul id="active-challenges-list" class="divide-y divide-gray-200">
                        <li class="py-4">
                            <div class="flex justify-between items-center mb-2">
                                <p class="text-xl font-medium text-blue-700">Global E-commerce Platform</p>
                                <span class="text-lg font-bold text-green-600">92.5% Team Fit</span>
                            </div>
                            <p class="text-gray-600 mb-2"><strong>Team:</strong> Alex Johnson, Kenji Watanabe</p>
                            <button class="text-blue-600 font-medium hover:underline">Go to Project Workspace &rarr;</button>
                        </li>
                    </ul>
                </div>

                <button id="dashboard-edit-culture-btn" class="w-full bg-gray-200 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-sm hover:bg-gray-300 transition duration-300">
                    Edit Company Culture Profile
                </button>
            </div>

            <!-- Common button for both dashboards -->
            <button type="button" class="back-to-home w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-8">
                &larr; Log Out
            </button>
        </div>

        <!-- View 6: Project Management Workspace -->
        <div id="pm-workspace-view" class="view">
            <header class="mb-6 border-b pb-4">
                <h1 class="text-3xl font-bold text-gray-800" id="pm-project-title">Global E-commerce Platform</h1>
                <p class="text-lg text-gray-600 mt-2">Manage your project, communicate with your team, and track progress.</p>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                
                <div class="md:col-span-2 space-y-8">
                    
                    <div>
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Milestones</h2>
                        <ul id="milestone-list" class="space-y-4">
                            <li class="flex items-center p-4 bg-green-50 border border-green-200 rounded-lg">
                                <input id="milestone-1" name="milestone-1" type="checkbox" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500" checked>
                                <label for="milestone-1" class="ml-4 text-lg text-gray-700 line-through">Phase 1: Discovery & Research</label>
                            </li>
                            <li class="flex items-center p-4 bg-white border border-gray-300 rounded-lg">
                                <input id="milestone-2" name="milestone-2" type="checkbox" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="milestone-2" class="ml-4 text-lg text-gray-800">Phase 2: Wireframes & Prototyping</label>
                            </li>
                            <li class="flex items-center p-4 bg-white border border-gray-300 rounded-lg">
                                <input id="milestone-3" name="milestone-3" type="checkbox" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="milestone-3" class="ml-4 text-lg text-gray-800">Phase 3: Final UI Design & Handoff</label>
                            </li>
                        </ul>
                    </div>

                    <div>
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Project Files</h2>
                        <ul id="file-list" class="divide-y divide-gray-200 border rounded-lg">
                            <li class="p-4 flex justify-between items-center">
                                <div>
                                    <p class="text-gray-800 font-medium">project_brief_v2.pdf</p>
                                    <p class="text-sm text-gray-500">Uploaded by Acme Inc.</p>
                                </div>
                                <a href="#" class="text-blue-600 font-medium hover:underline">Download</a>
                            </li>
                            <li class="p-4 flex justify-between items-center">
                                <div>
                                    <p class="text-gray-800 font-medium">wireframes_draft_1.fig</p>
                                    <p class="text-sm text-gray-500">Uploaded by Alex Johnson</p>
                                </div>
                                <a href="#" class="text-blue-600 font-medium hover:underline">Download</a>
                            </li>
                        </ul>
                        <button class="w-full text-blue-600 font-semibold py-3 px-6 rounded-lg hover:bg-blue-50 transition duration-300 mt-4 border border-blue-500">
                            + Upload File
                        </button>
                    </div>
                </div>

                <div class="md:col-span-1">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Team Chat</h2>
                    <div class="border rounded-lg bg-gray-50 h-[600px] flex flex-col">
                        <div id="chat-messages" class="flex-1 p-4 space-y-4 overflow-y-auto">
                            <div class="flex">
                                <div class="p-3 bg-gray-200 rounded-lg max-w-xs">
                                    <p class="text-sm text-gray-800">Hey Alex, the new brief is uploaded. Let me know what you think!</p>
                                    <p class="text-xs text-gray-500 text-right mt-1">Acme Inc.</p>
                                </div>
                            </div>
                            <div class="flex justify-end">
                                <div class="p-3 bg-blue-600 text-white rounded-lg max-w-xs">
                                    <p class="text-sm">Perfect, downloading it now. I'll get started on the wireframes.</p>
                                    <p class="text-xs text-blue-100 text-right mt-1">Alex Johnson</p>
                                </div>
                            </div>
                        </div>
                        <form id="chat-form" class="flex border-t p-4 bg-white rounded-b-lg">
                            <input type="text" id="chat-input" placeholder="Type your message..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button type="submit" class="ml-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition">
                                Send
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <button type="button" id="back-to-dashboard-btn" class="w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-12">
                &larr; Back to Dashboard
            </button>
        </div>
        
        <!-- View 6b: Project Creation (Renamed from 6) -->
        <div id="project-create-view" class="view">
            <header class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Create a New Project</h2>
                <p class="text-gray-600">Define your needs to find the perfect talent.</p>
            </header>
            
            <form id="project-create-form">
                <div class="mb-4">
                    <label for="project-type" class="block text-sm font-medium text-gray-700 mb-1">Project Description</label>
                    <input type="text" id="project-type" name="project-type" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., I need help designing a custom website" required>
                </div>
                
                <div class="mb-4">
                    <label for="freelancer-count" class="block text-sm font-medium text-gray-700 mb-1">Number of Freelancers</label>
                    <select id="freelancer-count" name="freelancer-count" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <option value="1">1 Freelancer</option>
                        <option value="2">2 Freelancers</option>
                        <option value="3">3 Freelancers</option>
                        <option value="4">4 Freelancers</option>
                        <option value="5">5 Freelancers</option>
                    </select>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Team Structure</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition flex-1">
                            <input type="radio" name="team-structure" value="individual" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500" required checked>
                            <span class="ml-4 text-gray-700">Individual Contributors</span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition flex-1">
                            <input type="radio" name="team-structure" value="team" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500" required>
                            <span class="ml-4 text-gray-700">A Cohesive Team</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                    Find Talent
                </button>
            </form>
        </div>

        <!-- View 7: Project Review (Renamed from 7) -->
        <div id="project-review-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Project Complete!</h1>
                <p class="text-lg text-gray-600 mt-2">Please provide feedback on the project: <span classs="font-semibold" id="review-project-title">"Global E-commerce Platform"</span></p>
            </header>
            
            <form id="project-review-form">

                <div id="client-review-section" class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">How was your experience with <span id="review-freelancer-name">Alex Johnson</span>?</h2>
                    
                    <div class="mb-6">
                        <label class="block text-lg font-medium text-gray-700 mb-2">Overall Project Outcome</label>
                        <div class="flex space-x-2">
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Poor</button>
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Fair</button>
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Good</button>
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Great</button>
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Excellent</button>
                        </div>
                    </div>
                </div>

                <div id="freelancer-review-section" class="mb-8" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">How was your experience with <span id="review-client-name">Acme Inc.</span>?</h2>
                    
                    <div class="mb-6">
                        <label class="block text-lg font-medium text-gray-700 mb-2">Clarity of Brief & Communication</label>
                         <div class="flex space-x-2">
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Poor</button>
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Fair</button>
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Good</button>
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Great</button>
                            <button type="button" class="rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Excellent</button>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="review-comments" class="block text-lg font-medium text-gray-700 mb-2">Additional Comments (Optional)</label>
                    <textarea id="review-comments" name="review-comments" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Any details about what went well or could be improved..."></textarea>
                </div>
                
                <button type="submit" id="submit-review-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                    Submit Review & Finish Project
                </button>
            </form>
        </div>

        <!-- View 8: Mentor Feedback (Renamed from 8) -->
        <div id="mentor-feedback-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Mentorship Check-in</h1>
                <p class="text-lg text-gray-600 mt-2">How is your mentorship relationship going?</p>
            </header>
            
            <form id="mentor-feedback-form">
                
                <div id="mentee-feedback-section" class="mb-6">
                    <label class="block text-lg font-medium text-gray-700 mb-2">How helpful has your mentor, <span id="feedback-mentor-name">Dr. Elena</span>, been recently?</label>
                    <div class="flex space-x-2">
                        <button type="button" class="feedback-rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Not Very Helpful</button>
                        <button type="button" class="feedback-rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Somewhat Helpful</button>
                        <button type="button" class="feedback-rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Helpful</button>
                        <button type="button" class="feedback-rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Very Helpful</button>
                    </div>
                </div>

                <div id="mentor-feedback-section" class="mb-6" style="display: none;">
                    <label class="block text-lg font-medium text-gray-700 mb-2">How engaged has your mentee, <span id="feedback-mentee-name">Jia Li</span>, been recently?</label>
                    <div class="flex space-x-2">
                        <button type="button" class="feedback-rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Not Very Engaged</button>
                        <button type="button" class="feedback-rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Somewhat Engaged</button>
                        <button type="button" class="feedback-rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Engaged</button>
                        <button type="button" class="feedback-rating-btn flex-1 text-gray-700 py-3 px-4 rounded-lg border hover:bg-gray-100">Very Engaged</button>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="feedback-comments" class="block text-lg font-medium text-gray-700 mb-2">Private Comments (Optional)</label>
                    <textarea id="feedback-comments" name="feedback-comments" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="This feedback is private and helps us ensure you have a high-quality match..."></textarea>
                </div>
                
                <button type="submit" id="submit-feedback-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                    Submit Feedback
                </button>
                <button type="button" id="skip-feedback-btn" class="w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                    Skip for Now
                </button>
            </form>
        </div>

        <!-- View 7: Company Loading (Renamed to 9) -->
        <div id="company-loading-view" class="view flex-col items-center justify-center h-64">
            <div class="loader"></div>
            <p class="text-lg text-gray-700 mt-6">Finding talent for your project...</p>
            <p class="text-gray-600">Analyzing profiles for the best fit.</p>
        </div>

        <!-- View 8: Company Results (Renamed to 10) -->
        <div id="company-results-view" class="view">
            <header class="mb-8">
                <h1 class="text-3xl font-bold text-gray-800" id="company-results-header">Project Matches</h1>
                <p class="text-lg text-gray-600 mt-2" id="company-project-details">Here are the best matches for "Global E-commerce Platform".</p>
            </header>

            <!-- Recommended Team (Conditional) -->
            <div id="team-results-container" class="mb-8" style="display: none;">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">Recommended Team</h2>
                <ul id="team-list" class="divide-y divide-gray-200">
                    <!-- Team injected here -->
                </ul>
            </div>

            <!-- Recommended Individuals -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">Recommended Individuals</h2>
                <ul id="talent-list" class="divide-y divide-gray-200">
                    <!-- Talent injected here -->
                </ul>
            </div>
            
            <button id="new-project-button" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 mt-8">
                Create New Project
            </button>
            <button type="button" class="back-to-home w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                &larr; Back to Home
            </button>
        </div>

        <!-- View 9: Personal Insights Report (Renamed to 11) -->
        <div id="insights-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Your Personal Insights</h1>
                <p class="text-lg text-gray-600 mt-2">Here's what we learned about your work style.</p>
            </header>

            <!-- Personality Radar Chart -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Your Personality Profile</h2>
                <div class="p-4 border rounded-lg bg-gray-50">
                    <canvas id="personality-chart"></canvas>
                </div>
            </div>
            
            <!-- Key Insights -->
            <div>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Key Insights</h2>
                <div class="space-y-4">
                    <!-- Remote Fit Score (from slide 15) -->
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-lg font-medium text-blue-800">Remote Fit Score</p>
                        <p class="text-3xl font-bold text-blue-600" id="remote-fit-score">91%</p>
                        <p class="text-blue-700 mt-1">You are highly suited for remote work and can thrive in an out-of-office environment.</p>
                    </div>
                    <!-- Top Trait -->
                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                        <p class="text-lg font-medium text-green-800">Your Top Trait</p>
                        <p class="text-3xl font-bold text-green-600" id="top-trait-name">Openness</p>
                        <p class="text-green-700 mt-1" id="top-trait-desc">You have a vivid imagination and are open to new ideas and experiences.</p>
                    </div>
                </div>
            </div>

            <button id="see-matches-button" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 mt-12">
                See Your Matches &rarr;
            </button>
            <button type="button" class="back-to-home w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                &larr; Back to Home
            </button>
        </div>

        <!-- View 10: 1-on-1 Comparison Report (Renamed to 12) -->
        <div id="comparison-view" class="view">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800" id="comparison-header">Comparison Report</h1>
                <p class="text-lg text-gray-600 mt-2" id="comparison-subheader">User 1 vs. User 2</p>
            </header>

            <!-- Comparison Radar Chart -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Personality Comparison</h2>
                <div class="p-4 border rounded-lg bg-gray-50">
                    <canvas id="comparison-chart"></canvas>
                </div>
            </div>
            
            <!-- Teamsight Scores -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Teamsight Scores</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Convergent Fit -->
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-lg font-medium text-blue-800">Convergent Fit (Similarity)</p>
                        <p class="text-3xl font-bold text-blue-600" id="convergent-score">20%</p>
                        <p class="text-blue-700 mt-1" id="convergent-desc">Direct collaboration, mentorship, and simultaneous work on similar tasks.</p>
                    </div>
                    <!-- Divergent Fit -->
                    <div class="p-4 bg-purple-50 border border-purple-200 rounded-lg">
                        <p class="text-lg font-medium text-purple-800">Divergent Fit (Complementary)</p>
                        <p class="text-3xl font-bold text-purple-600" id="divergent-score">66%</p>
                        <p class="text-purple-700 mt-1" id="divergent-desc">Creative processes, innovation, covering different grounds or specializations.</p>
                    </div>
                </div>
            </div>

            <!-- Trait-by-Trait Analysis -->
            <div>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Trait Analysis</h2>
                <div id="trait-analysis-container" class="space-y-6">
                    <!-- Analysis will be injected here -->
                </div>
            </div>

            <button id="back-to-matches-button" class="w-full bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-700 transition duration-300 mt-12">
                &larr; Back to Matches
            </button>
        </div>
        
    </div> <!-- End Main Application Container -->
    
    <!-- View 20: Project Health Check-in Modal -->
    <div id="project-health-modal" class="view modal-overlay">
            <div class="modal-content-wrapper">
                <header class="text-center mb-6">
                    <h1 class="text-3xl font-bold text-gray-800">Project Health Check-in</h1>
                    <p class="text-lg text-gray-600 mt-2">Just a 30-second check on your project:</p>
                    <p class="text-lg font-semibold text-blue-700" id="health-check-project-title">"Global E-commerce Platform"</p>
                </header>
                
                <form id="project-health-form">
                    
                    <div class="mb-8">
                        <label class="block text-lg font-medium text-gray-700 mb-4">How is the 'fit' with <span class="font-semibold" id="health-check-partner-name">Acme Inc.</span>?</label>
                        <div class="flex justify-between space-x-2" id="health-check-rating-buttons">
                            <button type="button" data-value="1" class="health-rating-btn flex-1 text-gray-700 py-3 px-2 rounded-lg border hover:bg-gray-100">Poor</button>
                            <button type="button" data-value="2" class="health-rating-btn flex-1 text-gray-700 py-3 px-2 rounded-lg border hover:bg-gray-100">Fair</button>
                            <button type="button" data-value="3" class="health-rating-btn flex-1 text-gray-700 py-3 px-2 rounded-lg border hover:bg-gray-100">Good</button>
                            <button type="button" data-value="4" class="health-rating-btn flex-1 text-gray-700 py-3 px-2 rounded-lg border hover:bg-gray-100">Great</button>
                            <button type="button" data-value="5" class="health-rating-btn flex-1 text-gray-700 py-3 px-2 rounded-lg border hover:bg-gray-100">Excellent</button>
                        </div>
                        <input type="hidden" id="health-check-fit-rating" name="fit_rating" value="">
                    </div>

                    <div class="mb-8">
                        <label class="block text-lg font-medium text-gray-700 mb-4">Is the project on track to meet its goals?</label>
                        <div class="space-y-4" id="health-check-status-buttons">
                            <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                                <input type="radio" name="project_status" value="yes" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500" required>
                                <span class="ml-4 text-gray-700 text-lg">Yes, everything is on track.</span>
                            </label>
                            <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                                <input type="radio" name="project_status" value="on-track" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500" required>
                                <span class="ml-4 text-gray-700 text-lg">It's on track, but there are some challenges.</span>
                            </label>
                            <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                                <input type="radio" name="project_status" value="no" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500" required>
                                <span class="ml-4 text-gray-700 text-lg">No, it's at risk of failing its goals.</span>
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" id="submit-health-check-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                        Submit Feedback
                    </button>
                    <button type="button" id="skip-health-check-btn" class="w-full text-gray-600 py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 mt-4">
                        Skip for Now
                    </button>
                </form>
            </div>
    </div>
    
    <!-- 
      MODERNIZATION:
      Your 'script.js' content is now embedded here.
      This script is modified to handle the new animated 
      view transitions.
    -->
    <script type="module">
    // --- APPLICATION STATE ---
    const state = {
        currentView: 'role-selection-view', // Default app view
        user: {
            id: null,
            name: '',
            email: '',
            // New onboarding data
            onboarding: {
                mentorOrMentee: null, // 'mentor', 'mentee', or 'both'
                menteeGoals: [],
                mentorFocus: [],
                availability: '',
                formats: [],
                cultureAnswers: []
            }
        },
        // Personality Test
        questions: [],
        scales: [],
        currentQuestionIndex: 0,
        answers: [],
        
        // Personality Results & Matches
        personalityResults: {
            scores: {},
            remoteFit: 0,
            topTrait: { name: '', description: '' }
        },
        matches: {
            projects: [],
            mentors: [],
            mentees: []
        },
        
        // Company Flow
        company: {
            id: null,
            name: '',
            cultureTestId: null,
            cultureAnswers: []
        },
        currentProject: {
            type: '',
            count: 1,
            structure: 'individual'
        },
        projectMatches: {
            talent: [],
            teams: []
        },
        
        // Comparison View
        comparison: {
            user1: { name: '', scores: {} },
            user2: { name: '', scores: {} },
            teamsight: { convergent: {}, divergent: {} },
            analysis: {}
        },
        
        // Transient app data (e.g., for assessments)
        appData: {
            currentOnboardingFlow: 'freelancer', // 'freelancer' or 'company'
            cultureQuestions: [], // TDL Culture Test questions
            currentCultureCategoryIndex: 0
        },

        previousView: 'role-selection-view', // To store where to go back to
        isTransitioning: false // MODERNIZATION: Flag to prevent double-clicks during animations
    };

    // --- MOCK API DATA (Based on TDL API Docs & Comparison PDF) ---
    const MOCK_API = {
        // ... (Original MOCK_API functions: getQuestions, getScales, sendAnswers, createUser, getInsightsAndMatches, createCompany, findTalentForProject, getComparison) ...
        // [Omitting original mock functions for brevity, they are unchanged]
        // Simulated GET /api/headless/personality/questions
        getQuestions: async () => {
            // console.log('SIMULATING: GET /api/headless/personality/questions');
            await new Promise(res => setTimeout(res, 300));
            return {
                success: true,
                data: [
                    { id: 1, text: "I am the life of the party." },
                    { id: 2, text: "I am always prepared." },
                    { id: 3, text: "I get stressed out easily." },
                    { id: 4, text: "I have a rich vocabulary." },
                    { id: 5, text: "I feel little concern for others." },
                    { id: 6, text: "I am relaxed most of the time." },
                    { id: 7, text: "I pay attention to details." },
                ]
            };
        },
        // Simulated GET /api/headless/personality/scales
        getScales: async () => {
            // console.log('SIMULATING: GET /api/headless/personality/scales');
            await new Promise(res => setTimeout(res, 300));
            return {
                success: true,
                data: [
                    { id: 1, title: "Completely Disagree" },
                    { id: 2, title: "Disagree" },
                    { id: 3, title: "Neutral" },
                    { id: 4, title: "Agree" },
                    { id: 5, title: "Completely Agree" }
                ]
            };
        },
        // Simulated POST /api/headless/personality/answers
        sendAnswers: async (subject_id, answers) => {
            console.log('SIMULATING: POST /api/headless/personality/answers', { subject_id, answers });
            await new Promise(res => setTimeout(res, 1000));
            return {
                success: true,
                data: { message: "Answers saved!" }
            };
        },
        // Simulated POST /api/headless/subject
        createUser: async (name, email) => {
            console.log('SIMULATING: POST /api/headless/subject', { first_name: name, last_name: '', email });
            await new Promise(res => setTimeout(res, 500)); // Simulate network delay
            const userId = Math.floor(Math.random() * 1000) + 1;
            return {
                success: true,
                data: {
                    id: userId,
                    name: name,
                    test_types: [{ id: 1, name: "Personality Test", status: "New candidate", completed: 0 }]
                }
            };
        },
        // Simulated GET /api/headless/personality/results/:subjectId
        getInsightsAndMatches: async (subject_id) => {
            console.log('SIMULATING: GET /api/headless/personality/results/', subject_id);
            await new Promise(res => setTimeout(res, 2000)); // Simulate analysis delay
            const personalityData = {
                scores: {
                    'Emotional Stability': Math.floor(Math.random() * 40) + 30, 'Agreeableness': Math.floor(Math.random() * 40) + 50, 'Conscientiousness': Math.floor(Math.random() * 40) + 40, 'Extraversion': Math.floor(Math.random() * 40) + 20, 'Openness': Math.floor(Math.random() * 30) + 70,
                }, remoteFit: Math.floor(Math.random() * 10) + 85, topTrait: { name: 'Openness', description: 'You have a vivid imagination and are curious about new ideas and experiences.' }
            };
            const matchData = {
                projects: [{ id: 1, title: "Global E-commerce Platform", role: "UX Lead", match: 92 }, { id: 2, title: "AI-Driven Marketing Strategy", role: "Project Manager", match: 85 }],
                mentors: [{ id: 101, name: "Dr. Elena Rodriguez", title: "Principal UX Designer", fitScore: 95.8 }, { id: 102, name: "Marcus Cole", title: "Senior Strategist", fitScore: 88.2 }],
                mentees: [{ id: 201, name: "Jia Li", title: "Junior Product Designer", fitScore: 91.5 }, { id: 202, name: "Sam O'Connell", title: "Aspiring Strategist", fitScore: 84.0 }]
            };
            return { success: true, data: { personalityResults: personalityData, matches: matchData } };
        },
        // Simulated POST for company login
        createCompany: async (name, email) => {
            console.log('SIMULATING: Company Login', { name, email });
            await new Promise(res => setTimeout(res, 500));
            const companyId = Math.floor(Math.random() * 1000) + 1;
            return {
                success: true,
                data: { id: companyId, name: name }
            };
        },
        // Simulated GET for project matches
        findTalentForProject: async (project) => {
            console.log('SIMULATING: Finding talent for project', project);
            await new Promise(res => setTimeout(res, 2000));
            const talent = [
                { id: 301, name: "Alex Johnson", title: "Senior UX Designer", fitScore: 94.2 }, { id: 302, name: "Maria Garcia", title: "Lead Data Scientist", fitScore: 91.5 }, { id: 101, name: "Dr. Elena Rodriguez", title: "Principal UX Designer", fitScore: 89.8 }, { id: 303, name: "Kenji Watanabe", title: "Full-Stack Developer", fitScore: 88.0 }, { id: 102, name: "Marcus Cole", title: "Senior Strategist", fitScore: 85.1 }
            ];
            let teams = [];
            if (project.structure === 'team') {
                teams = [{ id: 501, name: `Project "${project.type.split(' ')[0]}" Team`, teamFit: 92.5, members: [talent[0], talent[3], talent[4]].slice(0, project.count) }];
            }
            return { success: true, data: { talent: talent.slice(0, 5), teams: teams } };
        },
        // Simulated GET /api/headless/personality/interpersonal-fit/:subjectAId/:subjectBId
        getComparison: async (userId, otherUserName) => {
            console.log(`SIMULATING: GET Interpersonal Fit for ${userId} and ${otherUserName}`);
            await new Promise(res => setTimeout(res, 1000));
            const user1Scores = state.personalityResults.scores;
            const user1Name = state.user.name;
            const user2Scores = {
                'Emotional Stability': Math.floor(Math.random() * 50) + 50, 'Agreeableness': Math.floor(Math.random() * 40) + 60, 'Conscientiousness': Math.floor(Math.random() * 40) + 40, 'Extraversion': Math.floor(Math.random() * 50) + 50, 'Openness': Math.floor(Math.random() * 50) + 20,
            };
            const analysisData = {
                emotionalStability: `Because ${otherUserName} lies in-between the two extremes...`, agreeableness: `Since ${user1Name} and ${otherUserName} are not too far away...`, conscientiousness: `It is likely that together ${user1Name} & ${otherUserName} are able to achieve a good work-life balance...`, extraversion: `If you combine ${user1Name} & ${otherUserName} with one another you are likely to end up with a balanced...`, openness: `Due to the fact that ${otherUserName}'s personality sits in the middle-part...`
            };
            return {
                success: true,
                data: {
                    user1: { name: user1Name, scores: user1Scores }, user2: { name: otherUserName, scores: user2Scores },
                    teamsight: { convergent: { score: 20, description: "Poor Convergent Fit..." }, divergent: { score: 66, description: "Fair Divergent Fit..." } },
                    analysis: analysisData
                }
            };
        },

        // --- NEW MOCK API FUNCTIONS for TDL Culture Test ---
        
        // (Freelancer) Simulated GET /api/headless/culture/questions (TDL 3.1)
        getCultureQuestions: async () => {
            console.log('SIMULATING: GET /api/headless/culture/questions');
            await new Promise(res => setTimeout(res, 500));
            return {
                success: true,
                data: [
                    {
                        category_id: 1, title: "People and Workplace",
                        questions: [
                            { id: 1, text: "A creative and high-energy work environment" },
                            { id: 2, text: "A friendly work environment" },
                            { id: 3, text: "Working with people from different walks of life" },
                        ]
                    },
                    {
                        category_id: 2, title: "Values and Mission",
                        questions: [
                            { id: 9, text: "Attractive products and services" },
                            { id: 10, text: "A clear and inspiring mission" },
                            { id: 11, text: "A strong focus on sustainability" },
                        ]
                    }
                ]
            };
        },
        // (Freelancer) Simulated POST /api/headless/culture/answers (TDL 3.2)
        sendCultureAnswers: async (subject_id, categories) => {
            console.log('SIMULATING: POST /api/headless/culture/answers', { subject_id, categories });
            await new Promise(res => setTimeout(res, 1000));
            return {
                success: true,
                data: { message: "Answers saved!" }
            };
        },
        // (Company) Simulated POST /api/headless/culture/company (TDL 7.1)
        createCompanyCultureTest: async (companyName) => {
            console.log('SIMULATING: POST /api/headless/culture/company', { name: companyName });
            await new Promise(res => setTimeout(res, 500));
            const testId = Math.floor(Math.random() * 100) + 50;
            return { test_id: testId };
        },
        // (Company) Simulated GET /api/headless/culture/company/categories (TDL 7.2)
        getCompanyCultureCategories: async () => {
            console.log('SIMULATING: GET /api/headless/culture/company/categories');
            await new Promise(res => setTimeout(res, 300));
            return [
                { id: 1, text: "People and Workplace", short_text: "", validation: "required" },
                { id: 2, text: "Values and Mission", short_text: "", validation: "required" }
            ];
        },
        // (Company) Simulated GET /api/headless/culture/company/questions/category/{id} (TDL 7.3)
        getCompanyCultureQuestionsForCategory: async (categoryId) => {
            console.log('SIMULATING: GET /api/headless/culture/company/questions/category/', categoryId);
            await new Promise(res => setTimeout(res, 300));
            const questions = {
                1: [
                    { id: 1, text: "A creative and high-energy work environment", category_id: 1 },
                    { id: 2, text: "A friendly work environment", category_id: 1 },
                    { id: 3, text: "Working with people from different walks of life", category_id: 1 },
                ],
                2: [
                    { id: 9, text: "Attractive products and services", category_id: 2 },
                    { id: 10, text: "A clear and inspiring mission", category_id: 2 },
                    { id: 11, text: "A strong focus on sustainability", category_id: 2 },
                ]
            };
            return questions[categoryId] || [];
        },
        // (Company) Simulated POST /api/headless/culture/company/category/answers (TDL 7.5)
        postCompanyCultureAnswers: async (test_id, category_id, answers) => {
            console.log('SIMULATING: POST /api/headless/culture/company/category/answers', { test_id, category_id, answers });
            await new Promise(res => setTimeout(res, 500));
            return { message: "Answers saved!" };
        }
    };

    // --- DOMContentLoaded ---
    // No longer need DOMContentLoaded because the script is at the end
    // of the body, but we'll keep the logic contained.

    // --- NEW SVG ICONS ---
    const personIcon = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 21.75c-2.673 0-5.316-.351-7.812-1.04a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
        </svg>`;
    
    const projectIcon = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a.375.375 0 0 1-.375-.375V6.75A3.75 3.75 0 0 0 10.5 3h-1.875a.375.375 0 0 1-.375-.375V1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" clip-rule="evenodd" />
            <path d="M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.5a.375.375 0 0 0 .375.375h1.875a5.23 5.23 0 0 1 3.434 1.279.75.75 0 0 0 1.06-1.06A6.73 6.73 0 0 0 16.5 6.75h-1.875a1.875 1.875 0 0 1-1.875-1.875V3.375a6.73 6.73 0 0 0-4.06-1.279.75.75 0 0 0-.27.72Z" />
        </svg>`;
    // --- End SVG ICONS ---

    // --- DOM Elements ---
    const appBody = document.body;
    const landingPage = document.getElementById('landing-page');
    const appContainer = document.getElementById('app-container');
    const getStartedButtons = document.querySelectorAll('.get-started-btn');
    const backToHomeButtons = document.querySelectorAll('.back-to-home');

    const views = document.querySelectorAll('.view');
    const registerForm = document.getElementById('register-form');
    const assessmentForm = document.getElementById('assessment-form');
    const questionText = document.getElementById('question-text');
    const scalesContainer = document.getElementById('scales-container');
    const progressText = document.getElementById('progress-text');
    const progressBar = document.getElementById('progress-bar');
    const nextButton = document.getElementById('next-button');
    const answerError = document.getElementById('answer-error');
    
    const resultsHeader = document.getElementById('results-header');
    const projectsList = document.getElementById('projects-list');
    const mentorsList = document.getElementById('mentors-list');
    const menteesList = document.getElementById('mentees-list');

    // Role Selection Elements
    const roleSelectionView = document.getElementById('role-selection-view');
    const roleFreelancerButton = document.getElementById('role-freelancer');
    const roleCompanyButton = document.getElementById('role-company');
    const backToRoleButtons = document.querySelectorAll('.back-to-role'); // Back to role select
    

    // Company Flow Elements
    const companyLoginForm = document.getElementById('company-login-form');
    const projectCreateForm = document.getElementById('project-create-form');
    const companyResultsView = document.getElementById('company-results-view');
    
    const companyResultsHeader = document.getElementById('company-results-header');
    const companyProjectDetails = document.getElementById('company-project-details');
    const teamResultsContainer = document.getElementById('team-results-container');
    const teamList = document.getElementById('team-list');
    const talentList = document.getElementById('talent-list');
    const newProjectButton = document.getElementById('new-project-button');

    // Insights View Elements
    const insightsView = document.getElementById('insights-view');
    const personalityChartCanvas = document.getElementById('personality-chart');
    const remoteFitScore = document.getElementById('remote-fit-score');
    const topTraitName = document.getElementById('top-trait-name');
    const topTraitDesc = document.getElementById('top-trait-desc');
    const seeMatchesButton = document.getElementById('see-matches-button');
    const viewInsightsButton = document.getElementById('view-insights-button');
    let personalityChart = null; // To hold the chart instance

    // Comparison View Elements
    const comparisonView = document.getElementById('comparison-view');
    const comparisonHeader = document.getElementById('comparison-header');
    const comparisonSubheader = document.getElementById('comparison-subheader');
    const comparisonChartCanvas = document.getElementById('comparison-chart');
    const convergentScore = document.getElementById('convergent-score');
    const convergentDesc = document.getElementById('convergent-desc');
    const divergentScore = document.getElementById('divergent-score');
    const divergentDesc = document.getElementById('divergent-desc');
    const traitAnalysisContainer = document.getElementById('trait-analysis-container');
    const backToMatchesButton = document.getElementById('back-to-matches-button');
    let comparisonChart = null; // To hold the comparison chart instance

    // --- NEW DOM Elements (from Views 10-19) ---

    // View 10: Mentor/Mentee Role Selection
    const selectFindMentor = document.getElementById('select-find-mentor');
    const selectBeMentor = document.getElementById('select-be-mentor');
    const selectBothRoles = document.getElementById('select-both-roles');

    // View 11: Mentee Goals
    const menteeGoalsForm = document.getElementById('mentee-goals-form');
    const backToMentorSelectBtns = document.querySelectorAll('.back-to-mentor-select-btn'); // Shared class

    // View 12: Mentor Focus
    const mentorFocusForm = document.getElementById('mentor-focus-form');

    // View 13: Logistics & Availability
    const logisticsForm = document.getElementById('logistics-form');

    // View 14: Work Values Assessment (WVA)
    const wvaProgressText = document.getElementById('wva-progress-text');
    const wvaProgressBar = document.getElementById('wva-progress-bar');
    const wvaCategoryTitle = document.getElementById('wva-category-title');
    const wvaForm = document.getElementById('wva-form');
    const wvaScalesContainer = document.getElementById('wva-scales-container');
    const wvaNextButton = document.getElementById('wva-next-button');

    // View 15: Company Culture Start
    const companyCultureStartForm = document.getElementById('company-culture-start-form');

    // View 16: Dashboard
    const freelancerDashboardContent = document.getElementById('freelancer-dashboard-content');
    const freelancerWelcome = document.getElementById('freelancer-welcome');
    const myMentorCard = document.getElementById('my-mentor-card');
    const myMenteesList = document.getElementById('my-mentees-list');
    const dashboardProjectsList = document.getElementById('dashboard-projects-list');
    const dashboardSeeAllMatchesBtn = document.getElementById('dashboard-see-all-matches-btn');
    const dashboardViewInsightsBtn = document.getElementById('dashboard-view-insights-btn');

    const clientDashboardContent = document.getElementById('client-dashboard-content');
    const clientWelcome = document.getElementById('client-welcome');
    const dashboardPostChallengeBtn = document.getElementById('dashboard-post-challenge-btn');
    const activeChallengesList = document.getElementById('active-challenges-list');
    const dashboardEditCultureBtn = document.getElementById('dashboard-edit-culture-btn');

    // View 17: PM Workspace
    const pmProjectTitle = document.getElementById('pm-project-title');
    const milestoneList = document.getElementById('milestone-list');
    const fileList = document.getElementById('file-list');
    const chatMessages = document.getElementById('chat-messages');
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const backToDashboardBtn = document.getElementById('back-to-dashboard-btn');

    // View 18: Project Review
    const projectReviewForm = document.getElementById('project-review-form');
    const reviewProjectTitle = document.getElementById('review-project-title');
    const clientReviewSection = document.getElementById('client-review-section');
    const reviewFreelancerName = document.getElementById('review-freelancer-name');
    const freelancerReviewSection = document.getElementById('freelancer-review-section');
    const reviewClientName = document.getElementById('review-client-name');
    const reviewComments = document.getElementById('review-comments');
    const submitReviewBtn = document.getElementById('submit-review-btn');

    // View 19: Mentor Feedback
    const mentorFeedbackForm = document.getElementById('mentor-feedback-form');
    const menteeFeedbackSection = document.getElementById('mentee-feedback-section');
    const feedbackMentorName = document.getElementById('feedback-mentor-name');
    const mentorFeedbackSection = document.getElementById('mentor-feedback-section');
    const feedbackMenteeName = document.getElementById('feedback-mentee-name');
    const feedbackComments = document.getElementById('feedback-comments');
    const submitFeedbackBtn = document.getElementById('submit-feedback-btn');
    const skipFeedbackBtn = document.getElementById('skip-feedback-btn');

    // --- Scroll Animation Logic ---
    // MODERNIZATION: Using the more dynamic 'fade-in-up' class
    const scrollElements = document.querySelectorAll('.fade-in, .fade-in-up');
    
    // Check if the Intersection Observer API is supported
    if ("IntersectionObserver" in window) {
        const observerOptions = {
            root: null, // relative to the viewport
            rootMargin: '0px',
            threshold: 0.1 // 10% of the element must be visible
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    // Add the "is-visible" class to trigger the animation
                    entry.target.classList.add('is-visible');
                    // Stop observing the element once it has faded in
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // Observe each .fade-in element
        scrollElements.forEach(el => {
            if (el) { // Check if element exists
                observer.observe(el);
            }
        });
    } else {
        // Fallback for older browsers (just show the elements)
        scrollElements.forEach(el => {
            if (el) {
                el.classList.add('is-visible');
            }
        });
    }
    // --- End of New Scroll Logic ---


    // View 20: Project Health Check-in
    const projectHealthModal = document.getElementById('project-health-modal');
    const projectHealthForm = document.getElementById('project-health-form');
    const healthCheckRatingButtons = document.getElementById('health-check-rating-buttons');
    const healthCheckFitRatingInput = document.getElementById('health-check-fit-rating');
    const submitHealthCheckBtn = document.getElementById('submit-health-check-btn');
    const skipHealthCheckBtn = document.getElementById('skip-health-check-btn');


    // --- VIEW MANAGEMENT ---
    
    function startApp() {
        appBody.classList.add('app-active');
        // Show the first view immediately without transition
        const firstView = document.getElementById(state.currentView);
        firstView.style.display = 'block';
    }

    function goToLandingPage() {
        appBody.classList.remove('app-active');
        resetAllState();
        // We also need to hide the app-container and its views
        document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
    }

    /*
     * MODERNIZATION: Rewritten changeView function
     * This function now uses CSS animations for "slick" transitions
     * between views instead of just swapping 'display'.
     */
    function changeView(viewId) {
        if (state.isTransitioning || state.currentView === viewId) {
            return; // Don't allow new transitions if one is already in progress
        }
        state.isTransitioning = true;

        const currentViewEl = document.getElementById(state.currentView);
        const nextViewEl = document.getElementById(viewId);

        if (!currentViewEl || !nextViewEl) {
            console.error("View not found!", currentViewEl, nextViewEl);
            state.isTransitioning = false;
            return;
        }

        // Store previous view
        if (viewId !== state.previousView) {
            state.previousView = state.currentView;
        }
        
        // 1. Add 'is-exiting' class to the current view to trigger fade-out
        currentViewEl.classList.add('is-exiting');

        // 2. Listen for the end of the exit animation
        currentViewEl.addEventListener('animationend', () => {
            // 3. Hide the old view
            currentViewEl.style.display = 'none';
            currentViewEl.classList.remove('is-exiting');

            // 4. Prepare the new view
            // Set display based on view type (modals/loaders are flex)
            const nextViewDisplay = (viewId.includes('loading') || viewId.includes('modal')) ? 'flex' : 'block';
            nextViewEl.style.display = nextViewDisplay;

            // 5. Add 'is-entering' class to trigger fade-in
            // We use requestAnimationFrame to ensure the 'display' change
            // has rendered before we add the animation class.
            requestAnimationFrame(() => {
                nextViewEl.classList.add('is-entering');
                
                // 6. Clean up after the enter animation
                nextViewEl.addEventListener('animationend', () => {
                    nextViewEl.classList.remove('is-entering');
                    // 7. Transition is complete
                    state.isTransitioning = false;
                }, { once: true });
            });

        }, { once: true }); // 'once: true' automatically removes the listener

        // Update the state
        state.currentView = viewId;
        window.scrollTo(0, 0);
    }


    // --- EVENT LISTENERS ---
    
    // Landing Page Listeners
    getStartedButtons.forEach(btn => btn.addEventListener('click', startApp));
    backToHomeButtons.forEach(btn => btn.addEventListener('click', goToLandingPage));

    // App Listeners
    registerForm.addEventListener('submit', handleRegistration);
    assessmentForm.addEventListener('submit', handleAnswerSubmit); // Personality Test

    // Role Selection Listeners
    roleFreelancerButton.addEventListener('click', () => handleRoleSelection('freelancer'));
    roleCompanyButton.addEventListener('click', () => handleRoleSelection('company'));
    backToRoleButtons.forEach(btn => btn.addEventListener('click', () => changeView('role-selection-view')));

    // Company Flow Listeners
    companyLoginForm.addEventListener('submit', handleCompanyLogin);
    projectCreateForm.addEventListener('submit', handleProjectCreate);
    newProjectButton.addEventListener('click', handleCreateNewProject);

    // Insights & Results Listeners
    seeMatchesButton.addEventListener('click', () => {
        renderResults();
        changeView('results-view');
    });
    viewInsightsButton.addEventListener('click', () => {
        renderInsightsReport();
        changeView('insights-view');
    });

    // Comparison View Listeners
    backToMatchesButton.addEventListener('click', () => changeView(state.previousView));

    // --- NEW EVENT LISTENERS (Views 10-19) ---

    // View 10: Mentor/Mentee Role Selection
    selectFindMentor.addEventListener('click', () => handleMentorSelect('mentee'));
    selectBeMentor.addEventListener('click', () => handleMentorSelect('mentor'));
    selectBothRoles.addEventListener('click', () => handleMentorSelect('both'));

    // View 11: Mentee Goals
    menteeGoalsForm.addEventListener('submit', handleMenteeGoalsSubmit);
    backToMentorSelectBtns.forEach(btn => {
        btn.addEventListener('click', () => changeView('mentor-mentee-select-view'));
    });

    // View 12: Mentor Focus
    mentorFocusForm.addEventListener('submit', handleMentorFocusSubmit);

    // View 13: Logistics
    logisticsForm.addEventListener('submit', handleLogisticsSubmit);

    // View 14: Work Values Assessment (Shared by Freelancer & Company)
    wvaForm.addEventListener('submit', handleWvaSubmit);

    // View 15: Company Culture Start
    companyCultureStartForm.addEventListener('submit', handleCompanyCultureStart);

    // View 16: Dashboard
    dashboardSeeAllMatchesBtn.addEventListener('click', () => {
        renderResults();
        changeView('results-view');
    });
    dashboardViewInsightsBtn.addEventListener('click', () => {
        renderInsightsReport();
        changeView('insights-view');
    });
    dashboardPostChallengeBtn.addEventListener('click', () => changeView('project-create-view'));
    dashboardEditCultureBtn.addEventListener('click', handleCompanyCultureStart); // Re-take test
    backToDashboardBtn.addEventListener('click', () => changeView('dashboard-view'));

    // View 17: PM Workspace
    chatForm.addEventListener('submit', handleChatSubmit);

    // View 18: Project Review
    projectReviewForm.addEventListener('submit', handleReviewSubmit);

    // View 19: Mentor Feedback
    mentorFeedbackForm.addEventListener('submit', handleFeedbackSubmit);
    skipFeedbackBtn.addEventListener('click', () => changeView('dashboard-view'));

    // View 20: Project Health Check-in
    projectHealthForm.addEventListener('submit', handleHealthCheckSubmit);
    skipHealthCheckBtn.addEventListener('click', closeHealthCheckModal);
    
    // Temp Test Button Listener
    document.getElementById('temp-health-check-trigger').addEventListener('click', showProjectHealthCheckModal);
    
    // Add click listener for the 5-star rating buttons
    healthCheckRatingButtons.addEventListener('click', (e) => {
        if (e.target.classList.contains('health-rating-btn')) {
            // Remove 'selected' from all buttons
            healthCheckRatingButtons.querySelectorAll('.health-rating-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            // Add 'selected' to the clicked button
            e.target.classList.add('selected');
            // Update the hidden input
            healthCheckFitRatingInput.value = e.target.dataset.value;
        }
    });


    // --- LOGIC ---

    function resetAllState() {
        // Reset freelancer state
        state.user = { 
            id: null, name: '', email: '',
            onboarding: { mentorOrMentee: null, menteeGoals: [], mentorFocus: [], availability: '', formats: [], cultureAnswers: [] }
        };
        state.currentQuestionIndex = 0;
        state.answers = [];
        state.personalityResults = {};
        state.matches = { projects: [], mentors: [], mentees: [] };
        
        // Reset company state
        state.company = { id: null, name: '', cultureTestId: null, cultureAnswers: [] };
        state.currentProject = { type: '', count: 1, structure: 'individual' };
        state.projectMatches = { talent: [], teams: [] };
        
        // Reset app data
        state.appData = {
            currentOnboardingFlow: 'freelancer', cultureQuestions: [], currentCultureCategoryIndex: 0
        };

        // Reset state
        state.currentView = 'role-selection-view';
        state.previousView = 'role-selection-view';
        state.isTransitioning = false;


        // Clear forms
        registerForm.reset();
        companyLoginForm.reset();
        projectCreateForm.reset();
        menteeGoalsForm.reset();
        mentorFocusForm.reset();
        logisticsForm.reset();
        
        // Destroy charts
        if (personalityChart) personalityChart.destroy();
        if (comparisonChart) comparisonChart.destroy();
        personalityChart = null;
        comparisonChart = null;
    }


    // Handle Role Selection
    function handleRoleSelection(role) {
        if (role === 'freelancer') {
            changeView('register-view');
        } else if (role === 'company') {
            changeView('company-login-view');
        }
    }

    // --- Freelancer Onboarding Flow ---

    // Step 1: Handle User Registration
    async function handleRegistration(e) {
        e.preventDefault();
        changeView('loading-view');
        
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;

        const response = await MOCK_API.createUser(name, email);
        if (response.success) {
            state.user = { ...state.user, ...response.data };
            // START of new onboarding flow
            changeView('mentor-mentee-select-view');
        } else {
            // Use a non-blocking message
            console.error("Registration failed. Please try again.");
            changeView('register-view');
        }
    }

    // Step 2: Handle Mentor/Mentee Selection
    function handleMentorSelect(role) {
        state.user.onboarding.mentorOrMentee = role;
        if (role === 'mentee') {
            changeView('mentee-goals-view');
        } else if (role === 'mentor') {
            changeView('mentor-focus-view');
        } else if (role === 'both') {
            changeView('mentee-goals-view'); // Start with mentee goals first
        }
    }

    // Step 3: Handle Mentee Goals
    function handleMenteeGoalsSubmit(e) {
        e.preventDefault();
        const goals = Array.from(menteeGoalsForm.querySelectorAll('input[name="mentee-goal"]:checked'))
                           .map(cb => cb.value);
        state.user.onboarding.menteeGoals = goals;
        
        if (state.user.onboarding.mentorOrMentee === 'both') {
            changeView('mentor-focus-view'); // Go to mentor form next
        } else {
            changeView('logistics-availability-view'); // Skip to logistics
        }
    }

    // Step 4: Handle Mentor Focus
    function handleMentorFocusSubmit(e) {
        e.preventDefault();
        const focus = Array.from(mentorFocusForm.querySelectorAll('input[name="mentor-focus"]:checked'))
                           .map(cb => cb.value);
        state.user.onboarding.mentorFocus = focus;
        changeView('logistics-availability-view'); // Go to logistics
    }

    // Step 5: Handle Logistics
    function handleLogisticsSubmit(e) {
        e.preventDefault();
        const availabilityRadio = logisticsForm.querySelector('input[name="availability"]:checked');
        if (!availabilityRadio) {
            console.error("No availability selected"); // Or show a UI error
            return;
        }
        const availability = availabilityRadio.value;
        const formats = Array.from(logisticsForm.querySelectorAll('input[name="format"]:checked'))
                               .map(cb => cb.value);
        state.user.onboarding.availability = availability;
        state.user.onboarding.formats = formats;

        // Mentorship onboarding complete. Start Work Values (Culture) onboarding.
        loadCultureAssessment('freelancer');
    }

    // Step 6: Load Work Values (Culture) Assessment (Shared Function)
    async function loadCultureAssessment(flow) {
        changeView('loading-view');
        state.appData.currentOnboardingFlow = flow; // 'freelancer' or 'company'
        
        let questionsData;
        if (flow === 'freelancer') {
            const res = await MOCK_API.getCultureQuestions();
            if (res.success) questionsData = res.data;
        } else {
            // For company, fetch categories then questions for each
            const categories = await MOCK_API.getCompanyCultureCategories();
            questionsData = [];
            for (const category of categories) {
                const questions = await MOCK_API.getCompanyCultureQuestionsForCategory(category.id);
                questionsData.push({
                    category_id: category.id,
                    title: category.text,
                    questions: questions
                });
            }
        }

        if (questionsData && questionsData.length > 0) {
            state.appData.cultureQuestions = questionsData;
            state.appData.currentCultureCategoryIndex = 0;
            renderCultureCategory();
            changeView('work-values-assessment-view');
        } else {
            console.error("Failed to load culture assessment.");
            changeView(state.previousView);
        }
    }

    // Step 7: Render Current Culture Category
    function renderCultureCategory() {
        const category = state.appData.cultureQuestions[state.appData.currentCultureCategoryIndex];
        wvaCategoryTitle.textContent = category.title;

        // Update progress
        const progress = ((state.appData.currentCultureCategoryIndex + 1) / state.appData.cultureQuestions.length) * 100;
        wvaProgressText.textContent = `Category ${state.appData.currentCultureCategoryIndex + 1} of ${state.appData.cultureQuestions.length}`;
        wvaProgressBar.style.width = `${progress}%`;

        // Render questions
        wvaScalesContainer.innerHTML = '';
        category.questions.forEach(q => {
            const div = document.createElement('div');
            div.className = 'wva-question py-2';
            div.innerHTML = `
                <label for="wva-q-${q.id}" class="block text-lg font-medium text-gray-700 mb-3">${q.text}</label>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-500">Not Important</span>
                    <input type="range" id="wva-q-${q.id}" data-question-id="${q.id}" min="0" max="100" value="50" class="w-full">
                    <span class="text-sm text-gray-500">Very Important</span>
                </div>
            `;
            wvaScalesContainer.appendChild(div);
        });

        // Update button text
        if (state.appData.currentCultureCategoryIndex === state.appData.cultureQuestions.length - 1) {
            wvaNextButton.textContent = "Submit & Continue";
        } else {
            wvaNextButton.textContent = "Next Category";
        }
    }

    // Step 8: Handle Work Values (Culture) Submission
    async function handleWvaSubmit(e) {
        e.preventDefault();
        
        // Save answers for current category
        const sliders = wvaForm.querySelectorAll('input[type="range"]');
        const answers = Array.from(sliders).map(slider => ({
            question_id: parseInt(slider.dataset.questionId, 10),
            value: parseInt(slider.value, 10)
        }));
        const category_id = state.appData.cultureQuestions[state.appData.currentCultureCategoryIndex].category_id;

        // Store based on flow
        if (state.appData.currentOnboardingFlow === 'freelancer') {
            state.user.onboarding.cultureAnswers.push({ category_id, answers });
        } else {
            state.company.cultureAnswers.push({ category_id, answers });
        }
        
        // Check if assessment is complete
        if (state.appData.currentCultureCategoryIndex < state.appData.cultureQuestions.length - 1) {
            // Next category
            state.appData.currentCultureCategoryIndex++;
            renderCultureCategory();
        } else {
            // Assessment is finished
            changeView('loading-view');
            
            if (state.appData.currentOnboardingFlow === 'freelancer') {
                // Freelancer flow: send answers, then start *personality* test
                await MOCK_API.sendCultureAnswers(state.user.id, state.user.onboarding.cultureAnswers);
                console.log("Freelancer culture test complete. Starting personality test.");
                await loadAssessment(); // This is the original personality test
            } else {
                // Company flow: send answers, then go to dashboard
                for (const cat of state.company.cultureAnswers) {
                    await MOCK_API.postCompanyCultureAnswers(state.company.cultureTestId, cat.category_id, cat.answers);
                }
                console.log("Company culture profile complete. Go to dashboard.");
                renderClientDashboard();
                changeView('dashboard-view');
            }
        }
    }


    // Step 9: Load Personality Assessment (Original function)
    async function loadAssessment() {
        // This is now step 9 of onboarding
        const [questionsRes, scalesRes] = await Promise.all([
            MOCK_API.getQuestions(),
            MOCK_API.getScales()
        ]);

        if (questionsRes.success && scalesRes.success) {
            state.questions = questionsRes.data;
            state.scales = scalesRes.data;
            state.currentQuestionIndex = 0;
            state.answers = [];
            renderQuestion();
            changeView('assessment-view');
        } else {
            console.error("Failed to load personality assessment. Please try again.");
            changeView(state.previousView);
        }
    }

    // Step 10: Render Personality Question (Original function)
    function renderQuestion() {
        const question = state.questions[state.currentQuestionIndex];
        questionText.textContent = question.text;
        const progress = ((state.currentQuestionIndex + 1) / state.questions.length) * 100;
        progressText.textContent = `Question ${state.currentQuestionIndex + 1} of ${state.questions.length}`;
        progressBar.style.width = `${progress}%`;
        scalesContainer.innerHTML = '';
        state.scales.forEach(scale => {
            const label = document.createElement('label');
            label.className = "flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition";
            label.innerHTML = `
                <input type="radio" name="answer" value="${scale.id}" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500" required>
                <span class="ml-4 text-gray-700 text-lg">${scale.title}</span>
            `;
            scalesContainer.appendChild(label);
        });
        nextButton.textContent = (state.currentQuestionIndex === state.questions.length - 1) ? "Submit & See Results" : "Next";
    }

    // Step 11: Handle Personality Answer Submission (Original function, MODIFIED)
    async function handleAnswerSubmit(e) {
        e.preventDefault();
        const selected = document.querySelector('input[name="answer"]:checked');
        
        if (!selected) {
            answerError.style.display = 'block';
            return;
        }
        answerError.style.display = 'none';

        state.answers.push({
            question_id: state.questions[state.currentQuestionIndex].id,
            scale_id: parseInt(selected.value)
        });

        if (state.currentQuestionIndex < state.questions.length - 1) {
            state.currentQuestionIndex++;
            renderQuestion();
        } else {
            // *** ENTIRE ONBOARDING IS FINISHED ***
            changeView('loading-view');
            await MOCK_API.sendAnswers(state.user.id, state.answers);
            const insightsRes = await MOCK_API.getInsightsAndMatches(state.user.id);
            if (insightsRes.success) {
                state.matches = insightsRes.data.matches;
                state.personalityResults = insightsRes.data.personalityResults;
                
                // NEW: Go to Dashboard instead of Insights
                renderFreelancerDashboard();
                changeView('dashboard-view');
            } else {
                console.error("Failed to get results.");
                changeView('assessment-view');
            }
        }
    }

    // --- Dashboard Rendering ---

    function renderFreelancerDashboard() {
        clientDashboardContent.style.display = 'none';
        freelancerDashboardContent.style.display = 'block';

        freelancerWelcome.textContent = `Welcome, ${state.user.name || 'Freelancer'}!`;
        
        // Mock render dashboard lists (in a real app, you'd fetch this)
        myMenteesList.innerHTML = state.matches.mentees.map(m => `
            <li class="py-2 flex justify-between items-center">
                <span class="text-gray-800">${m.name}</span>
                <button class="text-blue-600 font-medium hover:underline">View Profile</button>
            </li>
        `).join('') || '<li class="text-gray-500">No mentees matched yet.</li>';

        // --- NEW Dashboard Project List Render ---
        dashboardProjectsList.innerHTML = ''; // Clear it first
        if (state.matches.projects.length > 0) {
            state.matches.projects.slice(0, 2).forEach(p => { // Show top 2
                const li = document.createElement('li');
                li.innerHTML = `
                    <button class="match-card">
                        <div class="match-card-icon project">${projectIcon}</div>
                        <div class="match-card-content">
                            <p class="match-card-title">${p.title}</p>
                            <p class="match-card-subtitle">${p.role}</p>
                        </div>
                        <div class="match-card-score">
                            <span class="score-value">${p.match}%</span>
                            <span class="score-label">Match</span>
                        </div>
                    </button>
                `;
                dashboardProjectsList.appendChild(li);
            });
        } else {
             dashboardProjectsList.innerHTML = '<li class="text-gray-500">No projects matched yet.</li>';
        }
    }

    function renderClientDashboard() {
        freelancerDashboardContent.style.display = 'none';
        clientDashboardContent.style.display = 'block';

        clientWelcome.textContent = `${state.company.name || 'Company'} Dashboard`;
        
        // Mock render active challenges (in real app, you'd fetch this)
        activeChallengesList.innerHTML = `
            <li class="py-4">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-xl font-medium text-blue-700">Global E-commerce Platform</p>
                    <span class="text-lg font-bold text-green-600">92.5% Team Fit</span>
                </div>
                <p class="text-gray-600 mb-2"><strong>Team:</strong> Alex Johnson, Kenji Watanabe</p>
                <button class="text-blue-600 font-medium hover:underline" onclick="document.getElementById('pm-workspace-view').style.display = 'block'; document.getElementById('dashboard-view').style.display = 'none';">
                    Go to Project Workspace &rarr;
                </button>
            </li>
        `;
    }

    // --- Personal Insights & Results (Original Functions) ---

    function renderInsightsReport() {
        // Ensure data exists before rendering
        if (!state.personalityResults.scores) {
            console.error("No personality results to display");
            // Optionally, show a message to the user
            return;
        }

        const { scores, remoteFit, topTrait } = state.personalityResults;
        remoteFitScore.textContent = `${remoteFit || 0}%`;
        topTraitName.textContent = topTrait?.name || 'N/A';
        topTraitDesc.textContent = topTrait?.description || 'No description available.';

        const chartData = {
            labels: Object.keys(scores),
            datasets: [{
                label: 'Your Profile', data: Object.values(scores), fill: true,
                backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: 'rgb(59, 130, 246)',
                pointBackgroundColor: 'rgb(59, 130, 246)', pointBorderColor: '#fff',
            }]
        };
        const chartOptions = {
            scales: { r: { angleLines: { display: false }, suggestedMin: 0, suggestedMax: 100, pointLabels: { font: { size: 14 } } } },
            plugins: { legend: { display: false } }
        };
        
        if (personalityChart) {
            personalityChart.destroy();
        }
        
        // Check if canvas context exists
        if (personalityChartCanvas) {
           personalityChart = new Chart(personalityChartCanvas, { type: 'radar', data: chartData, options: chartOptions });
        }
    }

    function renderResults() {
        resultsHeader.textContent = `Welcome, ${state.user.name || 'User'}!`;
        projectsList.innerHTML = '';
        mentorsList.innerHTML = '';
        menteesList.innerHTML = '';

        // --- NEW Project List Render ---
        if(state.matches.projects.length > 0) {
            state.matches.projects.forEach(project => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <button class="match-card">
                        <div class="match-card-icon project">${projectIcon}</div>
                        <div class="match-card-content">
                            <p class="match-card-title">${project.title}</p>
                            <p class="match-card-subtitle">${project.role}</p>
                        </div>
                        <div class="match-card-score">
                            <span class="score-value">${project.match}%</span>
                            <span class="score-label">Match</span>
                        </div>
                    </button>`;
                projectsList.appendChild(li);
            });
        } else {
            projectsList.innerHTML = '<li class="text-gray-500 p-4">No projects matched yet.</li>';
        }
        
        // --- NEW Mentor List Render ---
        if (state.matches.mentors.length > 0) {
            state.matches.mentors.forEach(mentor => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <button data-name="${mentor.name}" class="comparison-button match-card">
                        <div class="match-card-icon person">${personIcon}</div>
                        <div class="match-card-content">
                            <p class="match-card-title">${mentor.name}</p>
                            <p class="match-card-subtitle">${mentor.title}</p>
                        </div>
                        <div class="match-card-score">
                            <span class="score-value">${mentor.fitScore.toFixed(1)}%</span>
                            <span class="score-label">Fit Score</span>
                        </div>
                    </button>`;
                mentorsList.appendChild(li);
            });
        } else {
            mentorsList.innerHTML = '<li class="text-gray-500 p-4">No mentors matched yet.</li>';
        }

        // --- NEW Mentee List Render ---
        if (state.matches.mentees.length > 0) {
            state.matches.mentees.forEach(mentee => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <button data-name="${mentee.name}" class="comparison-button match-card">
                        <div class="match-card-icon person">${personIcon}</div>
                        <div class="match-card-content">
                            <p class="match-card-title">${mentee.name}</p>
                            <p class="match-card-subtitle">${mentee.title}</p>
                        </div>
                        <div class="match-card-score">
                            <span class="score-value">${mentee.fitScore.toFixed(1)}%</span>
                            <span class="score-label">Fit Score</span>
                        </div>
                    </button>`;
                menteesList.appendChild(li);
            });
        } else {
            menteesList.innerHTML = '<li class="text-gray-500 p-4">No mentees matched yet.</li>';
        }
        
        // Add listeners to the new buttons
        document.querySelectorAll('.comparison-button').forEach(button => {
            // Remove old listener to prevent duplicates, just in case
            button.replaceWith(button.cloneNode(true));
        });
        document.querySelectorAll('.comparison-button').forEach(button => {
             button.addEventListener('click', () => handleShowComparison(button.dataset.name));
        });
    }

    // --- Company Flow Logic ---

    // Step C1: Handle Company Login (MODIFIED)
    async function handleCompanyLogin(e) {
        e.preventDefault();
        changeView('company-loading-view');
        
        const name = document.getElementById('company-name').value;
        const email = document.getElementById('company-email').value;

        const response = await MOCK_API.createCompany(name, email);
        if (response.success) {
            state.company = { ...state.company, ...response.data };
            // Start company onboarding
            changeView('company-culture-start-view');
        } else {
            console.error("Registration failed. Please try again.");
            changeView('company-login-view');
        }
    }

    // Step C2: Handle Company Culture Start
    async function handleCompanyCultureStart(e) {
        e.preventDefault();
        changeView('loading-view');
        const testRes = await MOCK_API.createCompanyCultureTest(state.company.name);
        state.company.cultureTestId = testRes.test_id;
        
        // Start the shared culture assessment, but in 'company' mode
        await loadCultureAssessment('company');
    }


    // Step C3: Handle Project Creation
    async function handleProjectCreate(e) {
        e.preventDefault();
        state.currentProject = {
            type: document.getElementById('project-type').value,
            count: parseInt(document.getElementById('freelancer-count').value, 10),
            structure: document.querySelector('input[name="team-structure"]:checked').value
        };
        changeView('company-loading-view');
        const matchesRes = await MOCK_API.findTalentForProject(state.currentProject);
        if (matchesRes.success) {
            state.projectMatches = matchesRes.data;
            renderCompanyResults();
        } else {
            console.error("Failed to find matches. Please try again.");
            changeView('project-create-view');
        }
    }

    // Step C4: Render Company Match Results
    function renderCompanyResults() {
        companyResultsHeader.textContent = `Matches for ${state.company.name}`;
        companyProjectDetails.textContent = `Here are the best matches for "${state.currentProject.type}".`;
        talentList.innerHTML = '';
        teamList.innerHTML = '';
        
        // --- NEW Talent List Render ---
        if (state.projectMatches.talent.length > 0) {
            state.projectMatches.talent.forEach(talent => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <button data-name="${talent.name}" class="comparison-button match-card">
                        <div class="match-card-icon person">${personIcon}</div>
                        <div class="match-card-content">
                            <p class="match-card-title">${talent.name}</p>
                            <p class="match-card-subtitle">${talent.title}</p>
                        </div>
                        <div class="match-card-score">
                            <span class="score-value">${talent.fitScore.toFixed(1)}%</span>
                            <span class="score-label">Fit Score</span>
                        </div>
                    </button>`;
                talentList.appendChild(li);
            });
        } else {
            talentList.innerHTML = '<li class="text-gray-500 p-4">No individual talent matched.</li>';
        }

        // --- NEW Team List Render ---
        if (state.currentProject.structure === 'team' && state.projectMatches.teams.length > 0) {
            state.projectMatches.teams.forEach(team => {
                const memberNames = team.members.map(m => m.name).join(', ');
                const li = document.createElement('li');
                li.innerHTML = `
                    <button class="match-card">
                        <div class="match-card-icon project">${projectIcon}</div>
                        <div class="match-card-content">
                            <p class="match-card-title">${team.name}</p>
                            <p class="match-card-subtitle">Members: ${memberNames}</p>
                        </div>
                        <div class="match-card-score">
                            <span class="score-value">${team.teamFit.toFixed(1)}%</span>
                            <span class="score-label">Team Fit</span>
                        </div>
                    </button>`;
                teamList.appendChild(li);
            });
            teamResultsContainer.style.display = 'block';
        } else {
            teamResultsContainer.style.display = 'none';
        }

        // Add listeners to new buttons
        document.querySelectorAll('.comparison-button').forEach(button => {
            // Remove old listener to prevent duplicates
            button.replaceWith(button.cloneNode(true));
        });
        document.querySelectorAll('.comparison-button').forEach(button => {
             button.addEventListener('click', () => handleShowComparison(button.dataset.name));
        });

        changeView('company-results-view');
    }
    
    // Step C5: Handle Create New Project
    function handleCreateNewProject() {
        projectCreateForm.reset();
        changeView('project-create-view');
    }
    
    // --- Comparison Flow Logic (Original) ---

    async function handleShowComparison(otherUserName) {
        // Fix for comparison: check for company name OR user name
        const currentUserName = state.user.name || state.company.name || "You";
        let currentUserScores = state.personalityResults.scores;

        // If no user scores (e.g., company flow), create mock scores
        if (!currentUserScores || Object.keys(currentUserScores).length === 0) {
            currentUserScores = {
                'Emotional Stability': 50, 'Agreeableness': 50, 'Conscientiousness': 50, 'Extraversion': 50, 'Openness': 50,
            };
        }
        
        changeView('loading-view');
        // Temporarily set user name and scores for the API call
        state.user.name = currentUserName;
        state.personalityResults.scores = currentUserScores;

        const compRes = await MOCK_API.getComparison(state.user.id || state.company.id, otherUserName);
        if (compRes.success) {
            state.comparison = compRes.data;
            renderComparisonReport();
            changeView('comparison-view');
        } else {
            console.error("Could not load comparison.");
            changeView(state.previousView);
        }
    }

    function renderComparisonReport() {
        const { user1, user2, teamsight, analysis } = state.comparison;
        comparisonHeader.textContent = `${user1.name} & ${user2.name}`;
        comparisonSubheader.textContent = "Interpersonal Fit Report";
        convergentScore.textContent = `${teamsight.convergent.score}%`;
        convergentDesc.textContent = teamsight.convergent.description;
        divergentScore.textContent = `${teamsight.divergent.score}%`;
        divergentDesc.textContent = teamsight.divergent.description;
        traitAnalysisContainer.innerHTML = '';
        const traitMap = {
            'Emotional Stability': analysis.emotionalStability, 'Agreeableness': analysis.agreeableness, 'Conscientiousness': analysis.conscientiousness, 'Extraversion': analysis.extraversion, 'Openness': analysis.openness
        };
        for (const [trait, text] of Object.entries(traitMap)) {
            const div = document.createElement('div');
            div.className = 'p-4 border rounded-lg';
            div.innerHTML = `<h3 class="text-xl font-semibold text-gray-800 mb-2">${trait}</h3><p class="text-gray-700 leading-relaxed">${text || 'Analysis not available.'}</p>`;
            traitAnalysisContainer.appendChild(div);
        }
        const chartData = {
            labels: Object.keys(user1.scores),
            datasets: [
                {
                    label: user1.name, data: Object.values(user1.scores), fill: true,
                    backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: 'rgb(59, 130, 246)',
                    pointBackgroundColor: 'rgb(59, 130, 246)', pointBorderColor: '#fff'
                },
                {
                    label: user2.name, data: Object.values(user2.scores), fill: true,
                    backgroundColor: 'rgba(22, 163, 74, 0.2)', borderColor: 'rgb(22, 163, 74)',
                    pointBackgroundColor: 'rgb(22, 163, 74)', pointBorderColor: '#fff'
                }
            ]
        };
        const chartOptions = {
            scales: { r: { angleLines: { display: false }, suggestedMin: 0, suggestedMax: 100, pointLabels: { font: { size: 14 } } } },
            plugins: { legend: { position: 'top' } }
        };
        if (comparisonChart) comparisonChart.destroy();
        if (comparisonChartCanvas) {
            comparisonChart = new Chart(comparisonChartCanvas, { type: 'radar', data: chartData, options: chartOptions });
        }
    }

    // --- NEW Handlers for Workspace & Feedback ---

    function handleChatSubmit(e) {
        e.preventDefault();
        const message = chatInput.value;
        if (!message.trim()) return;

        // Render user's message
        const messageEl = document.createElement('div');
        messageEl.className = 'flex justify-end';
        messageEl.innerHTML = `
            <div class="p-3 bg-blue-600 text-white rounded-lg max-w-xs">
                <p class="text-sm">${message}</p>
                <p class="text-xs text-blue-100 text-right mt-1">Me</p>
            </div>
        `;
        chatMessages.appendChild(messageEl);
        chatInput.value = '';
        chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
    }

    function handleReviewSubmit(e) {
        e.preventDefault();
        const comments = reviewComments.value;
        console.log("SUBMITTING REVIEW:", { comments }); // In real app, get rating
        // Use non-blocking message
        console.log("Review submitted! Returning to dashboard.");
        changeView('dashboard-view');
    }
    
    function handleFeedbackSubmit(e) {
        e.preventDefault();
        const comments = feedbackComments.value;
        console.log("SUBMITTING FEEDBACK:", { comments }); // In real app, get rating
        // Use non-blocking message
        console.log("Feedback submitted! Returning to dashboard.");
        changeView('dashboard-view');
    }

    // --- NEW: Project Health Check-in Functions ---

    function showProjectHealthCheckModal() {
        // In a real app, you'd populate this with the project data
        document.getElementById('health-check-project-title').textContent = '"Global E-commerce Platform"';
        document.getElementById('health-check-partner-name').textContent = 'Acme Inc.';
        
        // Reset form
        projectHealthForm.reset();
        healthCheckRatingButtons.querySelectorAll('.health-rating-btn').forEach(btn => {
            btn.classList.remove('selected');
        });
        healthCheckFitRatingInput.value = "";

        // Show the modal
        // This is a special view; we don't use changeView
        projectHealthModal.style.display = 'flex';
        // Force reflow to allow opacity transition
        requestAnimationFrame(() => {
             projectHealthModal.style.opacity = 1;
             projectHealthModal.querySelector('.modal-content-wrapper').style.transform = 'scale(1)';
        });
    }

    function closeHealthCheckModal() {
        // Animate out
        projectHealthModal.style.opacity = 0;
        projectHealthModal.querySelector('.modal-content-wrapper').style.transform = 'scale(0.95)';
        
        // Hide after animation
        setTimeout(() => {
            projectHealthModal.style.display = 'none';
        }, 300); // Must match CSS transition duration
    }

    function handleHealthCheckSubmit(e) {
        e.preventDefault();
        
        const fitRating = healthCheckFitRatingInput.value;
        const projectStatusRadio = projectHealthForm.querySelector('input[name="project_status"]:checked');

        if (!fitRating) {
            console.error("Please select a 'fit' rating.");
            // Show a UI error, not an alert
            return;
        }

        if (!projectStatusRadio) {
            console.error("Please select a project status.");
            // Show a UI error
            return;
        }

        const feedbackData = {
            project: document.getElementById('health-check-project-title').textContent,
            partner: document.getElementById('health-check-partner-name').textContent,
            fitRating: parseInt(fitRating, 10),
            projectStatus: projectStatusRadio.value
        };

        // This is the data you feed back to the algorithm
        console.log("PROJECT HEALTH CHECK SUBMITTED:", feedbackData);
        
        console.log("Thank you! Your feedback helps us make better matches.");
        closeHealthCheckModal();
    }
    </script>

</body>
</html>